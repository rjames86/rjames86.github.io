<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#ff6b00" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#ff6b00" media="(prefers-color-scheme: dark)">

<link rel="me" href="https://mastodon.social/@rjames">
<meta name="fediverse:creator" content="@rjames@mastodon.social">

<meta name="author" content="Ryan M">
<meta name="description" content="Posts and writings by Ryan M">
    <link rel="alternate" title="ryanmo.co JSON Feed" type="application/json" href="feed.json" />
    <link href="http://feedpress.me/ryanmoco" type="application/rss+xml" rel="alternate" title="ryanmo.co Full RSS Feed" />

    <title>Backup Your Email with Getmail - ryanmo.co</title>
    <link rel="stylesheet" href="https://ryanmo.co/theme/css/style.css">
</head>
<body>
    <!-- Fixed navigation banner -->
    <div class="nav-banner">
        <div class="nav-container">
            <h2 class="site-title"><a href="https://ryanmo.co/">ryanmo.co</a></h2>
            <nav class="nav-links">
                <a href="https://ryanmo.co/">Home</a>
                <a href="https://ryanmo.co/about">About</a>
            </nav>
        </div>
    </div>

    <header>
    </header>

    <main>
<article>
    <h1>Backup Your Email with Getmail</h1>
    <div class="article-meta">
        <time datetime="2015-09-06T06:45:00-07:00">2015-09-06</time>
        by Ryan M
        in <a href="https://ryanmo.co/category/tech">Tech</a>
    </div>
    <p>It's always a good idea to keep backups of data you can't replace, including email. For the last few years, I've had a script that automatically backs up my Gmail account. Since switching to Fastmail, I figured I should continue doing the same thing. It turned out, it was pretty easy to set up another account.</p>


<p>I've been meaning to write about backing up email for a few months now. With Dr. Drang's <a href="http://leancrew.com/all-this/2015/09/archiving-old-mail-with-formail/">recent post</a> about archiving email using <code>formail</code>, I figured this a good enough time as ever to post my solution.</p>
<p>To install <code>getmail</code>, you can use Homebrew, or <a href="http://pyropus.ca/software/getmail/documentation.html#installing">manually</a> if you're in to that sort of thing.</p>
<div class="codehilite"><pre><span></span><code><span class="err">brew install getmail</span>
</code></pre></div>

<p>For the configuration files, I first created a directory in my Home folder</p>
<div class="codehilite"><pre><span></span><code><span class="err">mkdir .getmail</span>
</code></pre></div>

<p>The config files for both Fastmail and Gmail are similar, but I'll include both for completeness</p>
<h4 id="gmail">Gmail</h4>
<div class="codehilite"><pre><span></span><code><span class="k">[retriever]</span>
<span class="na">type</span> <span class="o">=</span> <span class="s">SimpleIMAPSSLRetriever</span>
<span class="na">server</span> <span class="o">=</span> <span class="s">imap.gmail.com</span>
<span class="na">username</span> <span class="o">=</span> <span class="s">&lt;username&gt;@gmail.com</span>
<span class="na">mailboxes</span> <span class="o">=</span> <span class="s">(&quot;[Gmail]/All Mail&quot;,) # To pull all emails</span>
<span class="na">port</span> <span class="o">=</span> <span class="s">993</span>

<span class="k">[destination]</span>
<span class="na">type</span> <span class="o">=</span> <span class="s">Maildir</span>
<span class="na">path</span> <span class="o">=</span> <span class="s">~/gmail-archive/</span>

<span class="k">[options]</span>
<span class="c1"># print messages about each action (verbose = 2)</span>
<span class="c1"># Other options:</span>
<span class="c1"># 0 prints only warnings and errors</span>
<span class="c1"># 1 prints messages about retrieving and deleting messages only</span>
<span class="na">verbose</span> <span class="o">=</span> <span class="s">2</span>
<span class="na">message_log</span> <span class="o">=</span> <span class="s">~/Dropbox/Scripts/logs/gmail.log</span>
<span class="na">receieved</span> <span class="o">=</span> <span class="s">false</span>
<span class="na">delivered_to</span> <span class="o">=</span> <span class="s">false</span>
<span class="c1"># dont re-read messages its already pulled down</span>
<span class="na">read_all</span> <span class="o">=</span> <span class="s">false</span>
</code></pre></div>

<h4 id="fastmail">Fastmail</h4>
<div class="codehilite"><pre><span></span><code><span class="k">[retriever]</span>
<span class="na">type</span> <span class="o">=</span> <span class="s">SimpleIMAPSSLRetriever</span>
<span class="na">server</span> <span class="o">=</span> <span class="s">mail.messagingengine.com</span>
<span class="na">username</span> <span class="o">=</span> <span class="s">&lt;username&gt;@fastmail.com</span>
<span class="na">mailboxes</span> <span class="o">=</span> <span class="s">(&quot;INBOX.Archive&quot;,)</span>

<span class="k">[destination]</span>
<span class="na">type</span> <span class="o">=</span> <span class="s">Maildir</span>
<span class="na">path</span> <span class="o">=</span> <span class="s">~/fastmail-archive/</span>

<span class="k">[options]</span>
<span class="na">verbose</span> <span class="o">=</span> <span class="s">2</span>
<span class="na">read_all</span> <span class="o">=</span> <span class="s">false</span>
<span class="na">message_log</span> <span class="o">=</span> <span class="s">~/Dropbox/Scripts/logs/fastmail.log</span>
<span class="na">delivered_to</span> <span class="o">=</span> <span class="s">false</span>
<span class="na">received</span> <span class="o">=</span> <span class="s">false</span>
</code></pre></div>

<p>You'll notice that I don't include the password in either config. If password is omitted from a config on Mac OS, the first time you run <code>getmail</code>, you'll be prompted to enter your password and it will then be stored securely in KeyChain. Since I'm using Maildir as my type, you'll need to create special folders, with 3 specific subfolders</p>
<div class="codehilite"><pre><span></span><code>mkdir ~/fastmail-archive
mkdir !$/<span class="o">{</span>cur,tmp,new<span class="o">}</span> <span class="c1"># creates 3 new folders in ~/fastmail-archive</span>
</code></pre></div>

<p>The same will need to be done for ~/gmail-archive.</p>
<p>Once this is set up, you'll need to run the script once to enter in your password</p>
<div class="codehilite"><pre><span></span><code><span class="err">/usr/local/bin/getmail -q -r ~/.getmail/getmail.gmail</span>
</code></pre></div>

<p>If I ever need to view the emails, I do the same as Dr. Drang and use <code>mutt</code>, which can also be installed with Homebrew.</p>
<div class="codehilite"><pre><span></span><code><span class="err">mutt -R -f ~/gmail-archive</span>
</code></pre></div>
</article>
    </main>

    <footer>
        <p>&copy;  Ryan M. Powered by <a href="https://getpelican.com">Pelican</a></p>
    </footer>
</body>
</html>