<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#ff6b00" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#ff6b00" media="(prefers-color-scheme: dark)">

<link rel="me" href="https://mastodon.social/@rjames">
<meta name="fediverse:creator" content="@rjames@mastodon.social">

<meta name="author" content="Ryan M">
<meta name="description" content="Posts and writings by Ryan M">
    <link rel="alternate" title="ryanmo.co JSON Feed" type="application/json" href="feed.json" />
    <link href="http://feedpress.me/ryanmoco" type="application/rss+xml" rel="alternate" title="ryanmo.co Full RSS Feed" />

    <title>Log Foursquare Locations in Markdown - ryanmo.co</title>
    <link rel="stylesheet" href="https://ryanmo.co/theme/css/style.css">
</head>
<body>
    <!-- Fixed navigation banner -->
    <div class="nav-banner">
        <div class="nav-container">
            <h2 class="site-title"><a href="https://ryanmo.co/">ryanmo.co</a></h2>
            <nav class="nav-links">
                <a href="https://ryanmo.co/">Home</a>
                <a href="https://ryanmo.co/about">About</a>
            </nav>
        </div>
    </div>

    <header>
    </header>

    <main>
<article>
    <h1>Log Foursquare Locations in Markdown</h1>
    <div class="article-meta">
        <time datetime="2014-07-06T00:00:00-07:00">2014-07-06</time>
        by Ryan M
        in <a href="https://ryanmo.co/category/tech">Tech</a>
    </div>
    <p>I've always used Foursquare as a way to remember the places I had visited while traveling. Foursquare isn't really meant to be used in this way, and as a result, they don't make it easy to answer the question, "what was that restaurant I went to last time I was here?" I'm now using IFTTT to log all my checkins to a text file in my Dropbox account.</p>


<p>I like MultiMarkdown tables. So that my Foursquare checkins looked nice, I first created a file in my Dropbox account with a heading</p>
<div class="codehilite"><pre><span></span><code><span class="p">|</span> <span class="nv">Date</span> <span class="p">|</span>  <span class="nv">VenueName</span>  <span class="p">|</span> <span class="nv">VenueUrl</span> <span class="p">|</span> <span class="nv">Shout</span> <span class="p">|</span> <span class="nv">MapURL</span> <span class="p">|</span>  <span class="nv">City</span> <span class="p">|</span> <span class="nv">State</span> <span class="p">|</span> <span class="nv">Country</span> <span class="p">|</span>
<span class="p">|</span> <span class="p">:-</span><span class="s s-Atom">--:</span> <span class="p">|</span> <span class="p">:-</span><span class="s s-Atom">--:</span> <span class="p">|</span> <span class="p">:-</span><span class="s s-Atom">--:</span> <span class="p">|</span> <span class="p">:-</span><span class="s s-Atom">--:</span> <span class="p">|</span> <span class="p">:-</span><span class="s s-Atom">--:</span> <span class="p">|</span> <span class="p">:-</span><span class="s s-Atom">--:</span> <span class="p">|</span>
</code></pre></div>

<p>In IFTTT, I then created a recipe which matches my table headers</p>
<p><center><a href="https://ifttt.com/view_embed_recipe/187719-share-foursquare-checkins-in-mamarkdown-table" target = "_blank" class="embed_recipe embed_recipe-l_45" id= "embed_recipe-187719"><img src= 'https://ifttt.com/recipe_embed_img/187719' alt="IFTTT Recipe: Share Foursquare checkins in mamarkdown table connects foursquare to dropbox" width="370px" style="max-width:100%"/></a><script async type="text/javascript" src= "//ifttt.com/assets/embed_recipe.js"></script></center></p>
<p><img alt="IFTTT Content" src="https://ryanmo.co/2014/07/06/log-foursquare-locations-in-markdown/content.png" /></p>
<p>You may have noticed that I added an additional "Address" column that isn't getting filled out. IFTTT doesn't explicitly give the address of the venue you visited. However, the link to the Google Maps image contains GPS coordinates that I can use. Dr. Drang's <a href="http://www.leancrew.com/all-this/2014/07/extracting-coordinates-from-apple-maps/" title="Extracting coordinates from Apple Maps - All this">post</a> gave me the idea to parse out the coordinates and then use them how I'd like. This script, which I'm using with Hazel each time the file is updated, reverse geolocates the coordinates and returns the full address using OpenStreetMap. After that, it appends that address to each line in the markdown file.</p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="nv">FILE</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/Dropbox/IFTTT/foursquare/foursquare.txt&quot;</span>

<span class="nv">START</span><span class="o">=</span><span class="m">1</span>
<span class="nv">index</span><span class="o">=</span><span class="nv">$START</span>
<span class="nv">IFS</span><span class="o">=</span><span class="s1">$&#39;\n&#39;</span>     <span class="c1"># new field separator, the end of line</span>
<span class="k">for</span> line <span class="k">in</span> <span class="k">$(</span>cat <span class="nv">$FILE</span><span class="k">)</span>
<span class="k">do</span>
    <span class="nv">mapsurl</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$line</span> <span class="p">|</span> sed -n <span class="s1">&#39;s/.*(\(http.*\)).*/\1/p&#39;</span><span class="k">)</span><span class="p">;</span>

    <span class="nv">existingaddress</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$line</span> <span class="p">|</span> grep -E <span class="s1">&#39;^.*\(http.*\)(.*\|){2,}$&#39;</span><span class="k">)</span><span class="p">;</span>

    <span class="k">if</span> <span class="o">[[</span> ! <span class="nv">$mapsurl</span> <span class="o">||</span> <span class="nv">$existingaddress</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
        <span class="o">((</span> <span class="nv">index</span> <span class="o">=</span> index + <span class="m">1</span> <span class="o">))</span>
        <span class="k">continue</span>
    <span class="k">fi</span>

    <span class="nv">coords</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$mapsurl</span> <span class="p">|</span> sed -E <span class="s1">&#39;s/^.+\?center=([0-9.,-]+).+/\1/&#39;</span><span class="k">)</span><span class="p">;</span>
    <span class="nv">lat</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$coords</span> <span class="p">|</span> cut -f1 -d,<span class="k">)</span>
    <span class="nv">long</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$coords</span> <span class="p">|</span> cut -f2 -d,<span class="k">)</span>

    <span class="nv">address</span><span class="o">=</span><span class="k">$(</span>curl -s <span class="s2">&quot;http://nominatim.openstreetmap.org/reverse?format=json&amp;lat=</span><span class="si">${</span><span class="nv">lat</span><span class="si">}</span><span class="s2">&amp;lon=</span><span class="si">${</span><span class="nv">long</span><span class="si">}</span><span class="s2">&amp;zoom=18&amp;addressdetails=1&quot;</span><span class="k">)</span>

    <span class="nv">country</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$address</span> <span class="p">|</span> sed -e <span class="s1">&#39;s/.*\(&quot;country&quot;:&quot;.*&quot;\),.*/\1/&#39;</span> <span class="p">|</span> awk -F<span class="s1">&#39;&quot;&#39;</span> <span class="s1">&#39;/country/ {print $4}&#39;</span><span class="k">)</span>
    <span class="nv">city</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$address</span> <span class="p">|</span> sed -e <span class="s1">&#39;s/.*\(&quot;city&quot;:&quot;.*&quot;\),.*/\1/&#39;</span> <span class="p">|</span> awk -F<span class="s1">&#39;&quot;&#39;</span> <span class="s1">&#39;/city/ {print $4}&#39;</span><span class="k">)</span>
    <span class="nv">state</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$address</span> <span class="p">|</span> grep <span class="s2">&quot;\bstate\b&quot;</span> <span class="p">|</span> sed -e <span class="s1">&#39;s/.*\(&quot;state&quot;:&quot;.*&quot;\),.*/\1/&#39;</span> <span class="p">|</span> awk -F<span class="s1">&#39;&quot;&#39;</span> <span class="s1">&#39;/state/ {print $4}&#39;</span><span class="k">)</span>

    <span class="c1"># update the line of text</span>
    sed -i <span class="s1">&#39;&#39;</span> -e <span class="s2">&quot;</span><span class="si">${</span><span class="nv">index</span><span class="si">}</span><span class="s2">s/\(.*\)/\1 </span><span class="nv">$city</span><span class="s2"> | </span><span class="nv">$state</span><span class="s2"> | </span><span class="nv">$country</span><span class="s2"> |/&quot;</span> <span class="s2">&quot;</span><span class="nv">$FILE</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="o">((</span> <span class="nv">index</span> <span class="o">=</span> index + <span class="m">1</span> <span class="o">))</span>
<span class="k">done</span>
</code></pre></div>

<p>In the end, the table then ends up looking something like this:</p>
<table>
<thead>
<tr>
<th align="center">Date</th>
<th align="center">VenueName</th>
<th align="center">VenueUrl</th>
<th align="center">Shout</th>
<th align="center">MapURL</th>
<th align="center">City</th>
<th align="center">State</th>
<th align="center">Country</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">July 06, 2014 at 07:07PM</td>
<td align="center">Third Floor Espresso (3FE)</td>
<td align="center">http://4sq.com/rtEJWP</td>
<td align="center"></td>
<td align="center"><a href="http://maps.google.com/maps/api/staticmap?center=53.33998,-6.242084&amp;zoom=16&amp;size=710x440&amp;maptype=roadmap&amp;sensor=false&amp;markers=color:red%7C53.33998,-6.242084">Map Link</a></td>
<td align="center">Dublin</td>
<td align="center"></td>
<td align="center">Republic of Ireland</td>
</tr>
<tr>
<td align="center">July 06, 2013 at 10:00AM</td>
<td align="center">Wooly Pig Cafe</td>
<td align="center">http://4sq.com/1n5Scct</td>
<td align="center"></td>
<td align="center"><a href="http://maps.google.com/maps/api/staticmap?center=37.76522,-122.460266&amp;zoom=16&amp;size=710x440&amp;maptype=roadmap&amp;sensor=false&amp;markers=color:red%7C53.33842395309077,-6.234097712535167">Map Link</a></td>
<td align="center">San Francisco</td>
<td align="center">California</td>
<td align="center">United States of America</td>
</tr>
</tbody>
</table>
</article>
    </main>

    <footer>
        <p>&copy;  Ryan M. Powered by <a href="https://getpelican.com">Pelican</a></p>
    </footer>
</body>
</html>